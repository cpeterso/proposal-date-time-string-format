<html>
    <body>
        <p>
            The current <code>Date.parse(...);</code> behavior in JavaScript is not good. Mostly because the spec doesn't clearly define how it should work!<br/>
            To remedy this I'm writing a grammar to be submitted to ECMA so that all implementations will agree on how to implement <code>Date.parse</code>.<br/>
            The grammar will attempt to encompass all of the implementation specific behaviors currently supported by major vendors. For some examples <br/>
            of why this needs to happen check out <b><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1274354">this bug</a></b> on bugzilla.<br/>
            <br/>
            You can play around with the working implementation below. Please submit pull requests/issues on GitHub if something is wrong/lame. Thx! :)
            <br/>
        </p>
        <hr/>
        <center>
            <h4>Try out a date: <input size=60 value="05-26-88 00:01:23.456-07:00" id="date"/> <button onClick="parse()">parse!</button></h4>
        </center>
        <div id="output"></div>
        <hr/>
        <h4>Grammar (<a href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">https://en.wikipedia.org/wiki/Parsing_expression_grammar</a>)</h4>
    <iframe width="100%" height="100%" src="build/parser.html"></iframe>
    </body>
    <script>
        var module = {};
        var dateField = document.getElementById("date");
        var output = document.getElementById("output");
        var months = {jan: 1, feb: 2, mar: 3, apr: 4, may: 5, jun: 6, jul: 7, aug: 8, sep: 9, oct: 10, nov: 11, dec: 12};
        function parse() {
            try {
                var parseTree;
                var result;
                var syntaxError = false;

                try {
                    parseTree = module.exports.parse(dateField.value);
                } catch(e) {
                    syntaxError = true;
                    parseTree = e;
                }

                if (!syntaxError) {
                    var date = parseTree.date;
                    if (date.month.length > 2) {
                        date.month = months[date.month];
                    }
                    var datePart = date.year + "-" + date.month + "-" + date.day
                    var time = parseTree.time;
                    var timePart = "T00:00:00.000-07:00";
                    if (time !== undefined) {
                        if (time.hh === undefined ) {
                            time.hh = "00";
                        }
                        if (time.mm === undefined) {
                            time.mm = "00";
                        }
                        if (time.ss === undefined) {
                            time.ss = "00";
                        }
                        if (time.ms === undefined) {
                            time.ms = "000";
                        }
                        if (time.z === undefined || time.z === null) {
                            time.z = {sign:"+", hh:"01", mm:"00"}
                        } else {
                            if (time.z.hh === undefined) {
                                time.z.hh = "00";
                            }
                            if (time.z.mm === undefined) {
                                time.z.mm = "00";
                            }
                        }

                       timePart = "T";
                       timePart += time.hh;
                       timePart += ":";
                       timePart += time.mm;
                       timePart += ":";
                       timePart += time.ss;
                       timePart += ".";
                       timePart += time.ms;
                       timePart += time.z.sign;
                       timePart += time.z.hh;
                       timePart += ":";
                       timePart += time.z.mm;
                    }
                    result = new Date(datePart + timePart).toString();
                }

                output.innerHTML = "<code>new Date('"
                output.innerHTML += dateField.value + "')</code> with <b>this parser</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ";
                output.innerHTML += result === undefined ? "Invalid Date" : result;
                output.innerHTML += "<br/><br/> <code>new Date('"
                output.innerHTML += dateField.value + "')</code> with <b>existing parser</b> : ";
                output.innerHTML += new Date(dateField.value).toString();

                output.innerHTML += "<br/><br/>";
                if (syntaxError) {
                    output.innerHTML += parseTree;
                } else if (parseTree.toSource) {
                    // Some lucky users have access to the toSource method.
                    output.innerHTML += "parse tree: " + parseTree.toSource();
                }

            } catch (e) {
                output.innerHTML = e;
            }
        }
    </script>
    <script src="build/parser.js"></script>
    <a href="https://github.com/mrrrgn/proposal-date-time-string-format"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>
</html>
